{"remainingRequest":"/Users/carol/Documents/ptcg_account_web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/carol/Documents/ptcg_account_web/src/views/Inventory.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/carol/Documents/ptcg_account_web/src/views/Inventory.vue","mtime":1623228368664},{"path":"/Users/carol/Documents/ptcg_account_web/node_modules/cache-loader/dist/cjs.js","mtime":1617010042632},{"path":"/Users/carol/Documents/ptcg_account_web/node_modules/babel-loader/lib/index.js","mtime":1617010042638},{"path":"/Users/carol/Documents/ptcg_account_web/node_modules/cache-loader/dist/cjs.js","mtime":1617010042632},{"path":"/Users/carol/Documents/ptcg_account_web/node_modules/vue-loader/lib/index.js","mtime":1617010052190}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBYTFNYIGZyb20gInhsc3giOwppbXBvcnQgUG9rZW1vbk1hcHBpbmcgZnJvbSAiLi4vYXNzZXRzL3Bva2Vtb24tbWFwcGluZyI7CgppbXBvcnQgeyBtYXBHZXR0ZXJzIH0gZnJvbSAidnVleCI7CgpleHBvcnQgZGVmYXVsdCB7CiAgZGF0YTogKCkgPT4gewogICAgcmV0dXJuIHsKICAgICAgaXNTZWFyY2g6IGZhbHNlLAogICAgICBzZWFyY2hQb2tlbW9uOiAiIiwKICAgICAgdGVtcFBva2Vtb25zOiB7fSwKICAgICAgbG9hZGluZ0RpYWxvZzogZmFsc2UsCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcEdldHRlcnMoewogICAgICBpbnZlbnRvcmllczogImludmVudG9yaWVzIiwKICAgIH0pLAogIH0sCiAgYXN5bmMgbW91bnRlZCgpIHsKICAgIC8vIGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCJxdWVyeUludmVudG9yaWVzIik7CiAgfSwKICBtZXRob2RzOiB7CiAgICB0cmlnZ2VyVXBsb2FkKCkgewogICAgICB0aGlzLiRyZWZzLnVwbG9hZFBva2Vtb24uY2xpY2soKTsKICAgIH0sCiAgICBhc3luYyB1cGxvYWRQb2tlbW9uKGV2ZW50KSB7CiAgICAgIHRoaXMubG9hZGluZ0RpYWxvZyA9IHRydWU7CiAgICAgIGNvbnN0IGNvbnRlbnRCdWZmZXIgPSBhd2FpdCB0aGlzLnJlYWRGaWxlQXN5bmMoZXZlbnQpOwogICAgICBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgiY3JlYXRlUG9rZW1vbnMiLCB7CiAgICAgICAgbmV3UG9rZW1vbnM6IGNvbnRlbnRCdWZmZXIsCiAgICAgICAgbmFtZTogdGhpcy5zZWFyY2hQb2tlbW9uLAogICAgICB9KTsKICAgICAgdGhpcy5sb2FkaW5nRGlhbG9nID0gZmFsc2U7CiAgICB9LAogICAgcmVhZEZpbGVBc3luYyhldmVudCkgewogICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICAgIGNvbnN0IGZpbGVuYW1lID0gZXZlbnQudGFyZ2V0LmZpbGVzWzBdLm5hbWUuc3BsaXQoIi4iKVswXTsKICAgICAgICByZWFkZXIub25sb2FkID0gKGUpID0+IHsKICAgICAgICAgIC8qIFBhcnNlIGRhdGEgKi8KICAgICAgICAgIGNvbnN0IGJzdHIgPSBlLnRhcmdldC5yZXN1bHQ7CiAgICAgICAgICBjb25zdCB3YiA9IFhMU1gucmVhZChic3RyLCB7IHR5cGU6ICJiaW5hcnkiIH0pOwogICAgICAgICAgLyogR2V0IGZpcnN0IHdvcmtzaGVldCAqLwogICAgICAgICAgY29uc3Qgd3NuYW1lID0gd2IuU2hlZXROYW1lc1swXTsKICAgICAgICAgIGNvbnN0IHdzID0gd2IuU2hlZXRzW3dzbmFtZV07CiAgICAgICAgICAvKiBDb252ZXJ0IGFycmF5IG9mIGFycmF5cyAqLwogICAgICAgICAgY29uc3QgZGF0YSA9IFhMU1gudXRpbHMuc2hlZXRfdG9fanNvbih3cywgeyBoZWFkZXI6IDEgfSk7CgogICAgICAgICAgY29uc3QgcG9rZW1vbnMgPSBbXTsKICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBwb2tlbW9ucy5wdXNoKHsKICAgICAgICAgICAgICBuYW1lOiBgJHtkYXRhW2ldWzBdfSAtICR7ZGF0YVtpXVsxXX0gLSAke1Bva2Vtb25NYXBwaW5nW2ZpbGVuYW1lXX1gLAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHJlc29sdmUocG9rZW1vbnMpOwogICAgICAgIH07CgogICAgICAgIHJlYWRlci5yZWFkQXNCaW5hcnlTdHJpbmcoZXZlbnQudGFyZ2V0LmZpbGVzWzBdKTsKICAgICAgfSk7CiAgICB9LAogICAgYXN5bmMgY2FuY2VsU2VhcmNoUG9rZW1vbkFjdGlvbigpIHsKICAgICAgdGhpcy5pc1NlYXJjaCA9IGZhbHNlOwoKICAgICAgaWYgKHRoaXMuc2VhcmNoUG9rZW1vbikgewogICAgICAgIC8vIGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCJxdWVyeUludmVudG9yaWVzIik7CiAgICAgICAgdGhpcy5pbnZlbnRvcmllcyA9IFtdOwogICAgICAgIHRoaXMuc2VhcmNoUG9rZW1vbiA9ICIiOwogICAgICB9CiAgICB9LAogICAgYXN5bmMgcXVlcnlQb2tlbW9ucygpIHsKICAgICAgaWYgKCF0aGlzLnNlYXJjaFBva2Vtb24pIHJldHVybjsKCiAgICAgIGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCJxdWVyeUludmVudG9yaWVzIiwgewogICAgICAgIG5hbWU6IHRoaXMuc2VhcmNoUG9rZW1vbiwKICAgICAgfSk7CiAgICB9LAogICAgZWRpdFBva2Vtb25BY3Rpb24ocG9rZW1vbikgewogICAgICB0aGlzLnRlbXBQb2tlbW9uc1twb2tlbW9uLmlkXSA9IHBva2Vtb24ubmFtZTsKICAgICAgcG9rZW1vbi5pc0VkaXQgPSB0cnVlOwogICAgfSwKICAgIGNhbmNlbEVkaXRQb2tlbW9uQWN0aW9uKHBva2Vtb24pIHsKICAgICAgcG9rZW1vbi5uYW1lID0gdGhpcy50ZW1wUG9rZW1vbnNbcG9rZW1vbi5pZF07CiAgICAgIGRlbGV0ZSB0aGlzLnRlbXBQb2tlbW9uc1twb2tlbW9uLmlkXTsKCiAgICAgIHBva2Vtb24uaXNFZGl0ID0gZmFsc2U7CiAgICB9LAogICAgYXN5bmMgdXBkYXRlUG9rZW1vbkFjdGlvbihwb2tlbW9uKSB7CiAgICAgIGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCJ1cGRhdGVQb2tlbW9uIiwgewogICAgICAgIGlkOiBwb2tlbW9uLmlkLAogICAgICAgIG5hbWU6IHBva2Vtb24ubmFtZSwKICAgICAgICBzZWFyY2hQb2tlbW9uOiB0aGlzLnNlYXJjaFBva2Vtb24sCiAgICAgIH0pOwoKICAgICAgZGVsZXRlIHRoaXMudGVtcFBva2Vtb25zW3Bva2Vtb24uaWRdOwoKICAgICAgcG9rZW1vbi5pc0VkaXQgPSBmYWxzZTsKICAgIH0sCiAgfSwKICB1cGRhdGVkKCkgewogICAgaWYgKHRoaXMuaXNTZWFyY2gpIHsKICAgICAgdGhpcy4kcmVmcy5zZWFyY2hQb2tlbW9uLiRlbC5xdWVyeVNlbGVjdG9yKCJpbnB1dCIpLmZvY3VzKCk7CiAgICB9CiAgfSwKfTsK"},{"version":3,"sources":["Inventory.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkIA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Inventory.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div style=\"height: 100%; overflow: hidden;\">\n    <div class=\"d-flex\">\n      <h3>庫存紀錄</h3>\n      <v-spacer></v-spacer>\n      <v-text-field\n        style=\"max-width: 300px\"\n        v-if=\"isSearch\"\n        dense\n        hide-details\n        v-model=\"searchPokemon\"\n        @keyup=\"queryPokemons\"\n        @blur=\"isSearch = false\"\n        ref=\"searchPokemon\"\n      ></v-text-field>\n      <v-btn icon v-if=\"isSearch\" @click=\"cancelSearchPokemonAction\">\n        <v-icon color=\"grey lighten-1\">mdi-close</v-icon>\n      </v-btn>\n      <v-btn icon v-if=\"!isSearch\" @click=\"isSearch = true\">\n        <v-icon color=\"grey lighten-1\">mdi-magnify</v-icon>\n      </v-btn>\n    </div>\n    <v-list\n      style=\"height: 100%; overflow: hidden;\"\n      v-if=\"inventories.length > 0\"\n    >\n      <v-list-item>\n        <v-list-item-content>\n          <v-list-item-title>卡片名稱</v-list-item-title>\n        </v-list-item-content>\n        <v-list-item-content>\n          <v-list-item-title>庫存張數</v-list-item-title>\n        </v-list-item-content>\n        <v-list-item-content>\n          <v-list-item-title>全部金額</v-list-item-title>\n        </v-list-item-content>\n        <v-list-item-content>\n          <v-list-item-title>單張成本</v-list-item-title>\n        </v-list-item-content>\n        <v-list-item-content style=\"max-width:100px\">\n          <v-list-item-title>編輯</v-list-item-title>\n        </v-list-item-content>\n      </v-list-item>\n\n      <div style=\"height: 100%; overflow: auto; padding-bottom: 80px\">\n        <v-list-item\n          v-for=\"item of inventories\"\n          :key=\"item.id\"\n          style=\"border-bottom: 1px solid rgba(0, 0, 0, 0.12)\"\n        >\n          <v-list-item-content>\n            <v-list-item-title v-if=\"!item.pokemon.isEdit\">\n              {{ item.pokemon.name }}\n            </v-list-item-title>\n            <v-text-field\n              v-else\n              dense\n              hide-details\n              class=\"mr-4\"\n              v-model=\"item.pokemon.name\"\n            ></v-text-field>\n          </v-list-item-content>\n          <v-list-item-content>\n            {{ item.count }}\n          </v-list-item-content>\n          <v-list-item-content>\n            {{ item.total_price }}\n          </v-list-item-content>\n          <v-list-item-content>\n            {{ item.total_price / item.count || 0 }}\n          </v-list-item-content>\n          <v-list-item-content style=\"max-width:100px\">\n            <div>\n              <v-btn\n                color=\"red\"\n                icon\n                v-if=\"item.pokemon.isEdit\"\n                @click=\"cancelEditPokemonAction(item.pokemon)\"\n              >\n                <v-icon>mdi-close-thick</v-icon>\n              </v-btn>\n              <v-btn\n                color=\"green\"\n                icon\n                v-if=\"item.pokemon.isEdit\"\n                @click=\"updatePokemonAction(item.pokemon)\"\n              >\n                <v-icon>mdi-check-bold</v-icon>\n              </v-btn>\n              <v-btn\n                color=\"blue\"\n                icon\n                v-else\n                @click=\"editPokemonAction(item.pokemon)\"\n              >\n                <v-icon>mdi-pencil</v-icon>\n              </v-btn>\n            </div>\n          </v-list-item-content>\n        </v-list-item>\n      </div>\n    </v-list>\n    <div v-else-if=\"inventories.length == 0 && searchPokemon\">\n      查無寶可夢\n    </div>\n    <div v-else>請輸入寶可夢名稱搜尋列表</div>\n    <v-btn color=\"primary\" fab fixed bottom right @click=\"triggerUpload\"\n      ><v-icon>mdi-plus</v-icon></v-btn\n    >\n    <input\n      v-show=\"false\"\n      type=\"file\"\n      ref=\"uploadPokemon\"\n      @change=\"uploadPokemon\"\n    />\n    <v-dialog v-model=\"loadingDialog\" persistent width=\"300\">\n      <v-card color=\"primary\" dark>\n        <v-card-text class=\"mt-4\">\n          寶可夢通信中 ...\n          <v-progress-linear\n            indeterminate\n            color=\"white\"\n            class=\"mb-0\"\n          ></v-progress-linear>\n        </v-card-text>\n      </v-card>\n    </v-dialog>\n  </div>\n</template>\n<script>\n  import XLSX from \"xlsx\";\n  import PokemonMapping from \"../assets/pokemon-mapping\";\n\n  import { mapGetters } from \"vuex\";\n\n  export default {\n    data: () => {\n      return {\n        isSearch: false,\n        searchPokemon: \"\",\n        tempPokemons: {},\n        loadingDialog: false,\n      };\n    },\n    computed: {\n      ...mapGetters({\n        inventories: \"inventories\",\n      }),\n    },\n    async mounted() {\n      // await this.$store.dispatch(\"queryInventories\");\n    },\n    methods: {\n      triggerUpload() {\n        this.$refs.uploadPokemon.click();\n      },\n      async uploadPokemon(event) {\n        this.loadingDialog = true;\n        const contentBuffer = await this.readFileAsync(event);\n        await this.$store.dispatch(\"createPokemons\", {\n          newPokemons: contentBuffer,\n          name: this.searchPokemon,\n        });\n        this.loadingDialog = false;\n      },\n      readFileAsync(event) {\n        return new Promise((resolve) => {\n          const reader = new FileReader();\n          const filename = event.target.files[0].name.split(\".\")[0];\n          reader.onload = (e) => {\n            /* Parse data */\n            const bstr = e.target.result;\n            const wb = XLSX.read(bstr, { type: \"binary\" });\n            /* Get first worksheet */\n            const wsname = wb.SheetNames[0];\n            const ws = wb.Sheets[wsname];\n            /* Convert array of arrays */\n            const data = XLSX.utils.sheet_to_json(ws, { header: 1 });\n\n            const pokemons = [];\n            for (let i = 1; i < data.length; i++) {\n              pokemons.push({\n                name: `${data[i][0]} - ${data[i][1]} - ${PokemonMapping[filename]}`,\n              });\n            }\n            resolve(pokemons);\n          };\n\n          reader.readAsBinaryString(event.target.files[0]);\n        });\n      },\n      async cancelSearchPokemonAction() {\n        this.isSearch = false;\n\n        if (this.searchPokemon) {\n          // await this.$store.dispatch(\"queryInventories\");\n          this.inventories = [];\n          this.searchPokemon = \"\";\n        }\n      },\n      async queryPokemons() {\n        if (!this.searchPokemon) return;\n\n        await this.$store.dispatch(\"queryInventories\", {\n          name: this.searchPokemon,\n        });\n      },\n      editPokemonAction(pokemon) {\n        this.tempPokemons[pokemon.id] = pokemon.name;\n        pokemon.isEdit = true;\n      },\n      cancelEditPokemonAction(pokemon) {\n        pokemon.name = this.tempPokemons[pokemon.id];\n        delete this.tempPokemons[pokemon.id];\n\n        pokemon.isEdit = false;\n      },\n      async updatePokemonAction(pokemon) {\n        await this.$store.dispatch(\"updatePokemon\", {\n          id: pokemon.id,\n          name: pokemon.name,\n          searchPokemon: this.searchPokemon,\n        });\n\n        delete this.tempPokemons[pokemon.id];\n\n        pokemon.isEdit = false;\n      },\n    },\n    updated() {\n      if (this.isSearch) {\n        this.$refs.searchPokemon.$el.querySelector(\"input\").focus();\n      }\n    },\n  };\n</script>\n"]}]}